# 5.2. Авторизация и политики

## Результат
- **Статус:** ❌ Не пройдено
- **Severity:** S0
- **Краткое заключение:** большинство критичных операций выполняются без аутентификации и авторизационных проверок; Policies не используются.

## Наблюдение
- Публичные маршруты (`to-amocrm`, `get-accounts`, `pushProducts`) доступны без `auth`/`sanctum`.
- Контроллеры не используют Policies/Gates; проверки прав отсутствуют.
- В `TestController::accounts()` токены пользователей выводятся без авторизации.

## Доказательства
- `routes/web.php` — маршруты без middleware
- `app/Providers/AuthServiceProvider.php` — отсутствует регистрация Policies (проверить)
- `app/Http/Controllers/Api/V1/TestController.php:344-348`

## Риски
- Злоумышленник может выполнять операции от имени системы, менять резервы, выгружать данные.
- Нарушение требований заказчика по контролю доступа.

## Рекомендации
1. Ввести аутентификацию (Sanctum/Passport) для всех API-маршрутов.
2. Описать Policies для ключевых сущностей (Account, Product, Order, Doc).
3. Применять middleware `auth:sanctum`/`auth` на уровне маршрутов.
4. Внедрить проверку ролей и прав, убрать токены из кода.

## Следующие шаги
- 🟥 Ответственный: Backend
- ⏱ Срок: 1 неделя
- 📌 Контроль: code review запрещает публичные маршруты без middleware; тесты покрывают доступ по ролям.
