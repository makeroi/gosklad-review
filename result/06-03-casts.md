# 6.3. Касты и атрибуты

## Результат
- **Статус:** ⚠️ Требует проверки
- **Severity:** S2
- **Краткое заключение:** модели активно используют JSON-поля без строгих кастов; денежные значения и даты могут храниться как строки или float.

## Наблюдение
- Поле `fields` в продуктах/orders содержит вложенные структуры без типизации.
- Денежные значения (`price`, `cost_price`, `margin`) задаются через массивы/строки.
- Не проверялось наличие кастов `decimal`, `datetime`, `array`.

## Доказательства
- `app/Services/ProductService.php:262-296` — запись чисел в массив без кастов
- `app/Models/Product.php` — отсутствуют явные `$casts` для JSON-полей

## Риски
- Потеря точности (float) при расчётах, особенно при экспорте в Excel/amoCRM.
- Ошибки при сортировках/фильтрации (строка vs число).
- Сложно обеспечить обратную совместимость при изменении структуры.

## Рекомендации
1. Определить `$casts` для всех основных полей (decimal:2, datetime, array).
2. Рассмотреть переход на Value Objects для денег и дат.
3. Добавить unit-тесты, проверяющие касты (например, `assertInstanceOf(Carbon::class, $model->created_at)`).



