# 4.1. Границы слоев

## Результат
- **Статус:** ❌ Не пройдено
- **Severity:** S2
- **Краткое заключение:** бизнес-логика разбросана по маршрутам, контроллерам, helper-функциям; отсутствует чёткое разделение слоёв.

## Наблюдение
- `routes/web.php` содержит десятки замыканий с бизнес-логикой (обновление заказов, синхронизация с amoCRM, записи в файлы и т.д.).
- `app/Http/Controllers/Api/V1/TestController.php` выполняет генерацию документов, работу с файлами и кешем прямо в контроллере.
- Глобальные helper'ы (`app/Helpers/helpers.php`) вызывают `die`, пишут файлы, обрабатывают бизнес-правила.

## Доказательства
- `routes/web.php` — ~2300 строк с бизнес-операциями
- `app/Http/Controllers/Api/V1/TestController.php`
- `app/Helpers/helpers.php`

## Риски
- Трудно тестировать и сопровождать код («божественный» контроллер/роут).
- Ошибки в одном маршруте могут ломать не связанные сценарии.
- Высокий порог входа для новых разработчиков.

## Рекомендации
1. Разбить `routes/web.php` на группы, перенести бизнес-логику в контроллеры/сервисы.
2. Выделить доменные сервисы (DocsService, AmoSyncService, ReserveService и т.п.).
3. Минимизировать использование глобальных helper'ов; заменить на сервисы с DI.
4. Постепенно покрывать ключевые сервисы тестами.

## Следующие шаги
- 🟥 Ответственный: Архитектор/Tech Lead
- ⏱ Срок: 4-6 недель (итеративно)
- 📌 Контроль: code review должен запрещать новые бизнес-операции в маршрутах.
