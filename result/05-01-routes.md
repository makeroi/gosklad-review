# 5.1. Организация маршрутов

## Результат
- **Статус:** ❌ Не пройдено
- **Severity:** S0
- **Краткое заключение:** многочисленные публичные маршруты с бизнес-логикой и hard-coded токенами; отсутствуют middleware и rate-limit.

## Наблюдение
- `routes/web.php` содержит >2300 строк и включает:
  - публичные get/post-маршруты (`to-amocrm`, `get-accounts`, `queue/link` и т.д.);
  - тестовые эндпоинты (`360dialog/test*`, `pushProducts`) без защиты;
  - прямые обращения к Redis, файловой системе, amoCRM.
- Нет версионирования (`/api/v1/...` используется выборочно).

## Доказательства
- `routes/web.php:324-406`, `routes/web.php:401-430`, `routes/web.php:306-320`

## Риски
- Простая атака: подобрать URL и выполнить произвольную бизнес-операцию.
- Скрытые тестовые маршруты могут утечь во внешнюю документацию.
- Невозможно воспользоваться `route:cache` из-за замыканий.

## Рекомендации
1. Разделить маршруты по файлам и модулям, оставить в `web.php` только web-интерфейс.
2. Перенести API-эндпоинты в `routes/api.php` с префиксом `/api/v1`.
3. Применить middleware `auth`, `throttle`, `verify.signature`, по необходимости — `signed`.
4. Удалить/закрыть тестовые маршруты; использовать feature-флаги и отдельные окружения.

## Следующие шаги
- 🟥 Ответственный: Backend
- ⏱ Срок: немедленно (критический риск)
- 📌 Контроль: автоматический `php artisan route:cache` в CI; любые новые маршруты обязаны иметь middleware.
