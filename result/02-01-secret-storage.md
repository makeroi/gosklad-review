# 2.1. Хранение секретов

## Результат
- **Статус:** ❌ Не пройдено
- **Severity:** S0
- **Краткое заключение:** в репозитории обнаружены hard-coded токены и секреты; отсутствует централизованное управление секретами.

## Наблюдение
- В `routes/web.php` несколько маршрутов проверяют токен, жёстко прописанный в коде (`$2y$10$kgbcxVr0SBYgd3As35zRouyY0fxkNgt8kONCpuRpBjUyATS6KI0ke`, `kjhasd...` и т.п.).
- В `TestController` выводятся токены пользователей в браузер.
- Секреты не вынесены в `.env` и не защищены.

## Доказательства
- `routes/web.php:324-406` — токен в коде
- `routes/web.php:401-427` — «секретный» GET-параметр
- `app/Http/Controllers/Api/V1/TestController.php:344-348` — вывод токенов пользователей

## Риски
- Любой, кто получит доступ к коду или sniff-логам, сможет авторизоваться и выполнять операции от имени сервиса.
- Невозможна ротация ключей без релиза и пересборки.
- Блокирующее препятствие для соответствия требованиям безопасности заказчика.

## Рекомендации
1. Немедленно вынести все токены/ключи в `.env` и использовать `config()`/`env()` для чтения.
2. Очистить историю Git (BFG/git filter-repo) и удалить секреты из прошлых коммитов.
3. Настроить единое хранилище секретов (Vault, AWS Secrets Manager, Azure Key Vault) с журналированием и ротацией.
4. Перегенерировать все компрометированные токены.

## Следующие шаги
- 🟥 Ответственный: Backend + DevOps
- ⏱ Срок: немедленно (до 24 часов)
- 📌 Контроль: запуск security-сканера (gitleaks) в CI, аудит через месяц.
