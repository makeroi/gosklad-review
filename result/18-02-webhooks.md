# 18.2. Вебхуки и идемпотентность

## Результат
- **Статус:** ❌ Не пройдено
- **Severity:** S1
- **Краткое заключение:** вебхуки обрабатываются без подписи, идемпотентных ключей и журналирования; высокий риск двойной обработки.

## Наблюдение
- Эндпоинты `pushProducts`, `pushProduct`, `to-amocrm` просто пишут входящие данные в файл и выполняют операции.
- Нет таблицы для хранения event-id, нет проверки повторов.

## Доказательства
- `app/Http/Controllers/Api/V1/TestController.php:295-301`
- `routes/web.php:324-396`

## Риски
- Двойное списание или создание заказов при повторной доставке вебхука.
- Возможность подделки запроса.

## Рекомендации
1. Добавить подпись вебхука (HMAC) и проверять её.
2. Вести учёт обработанных событий (event_id + timestamp).
3. Реализовать идемпотентные ключи и повторную отправку при ошибке.



