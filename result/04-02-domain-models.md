# 4.2. Доменные модели и DTO/VO

## Результат
- **Статус:** ❌ Не пройдено
- **Severity:** S2
- **Краткое заключение:** доменные сущности представлены ассоциативными массивами и JSON-полями без типизации; отсутствуют DTO/Value Objects.

## Наблюдение
- Модели продуктов, заказов и документов хранят данные в `fields` (JSON) и оперируют ассоциативными массивами.
- Методы типа `ProductService::add()` принимают массивы и возвращают массивы без контрактов.
- Сервисные классы создают и модифицируют данные «вручную» (см. `DocumentService`, `Job`).

## Доказательства
- `app/Models/Product.php` (работа с JSON-полем `fields`)
- `app/Services/ProductService.php`
- `app/Helpers/helpers.php` — множество функций, возвращающих массивы

## Риски
- Легко допустить ошибку в названии ключа и не заметить её до runtime.
- Сложно валидировать данные и переиспользовать код.
- Высокая цена изменений (refactor → большое количество мест).

## Рекомендации
1. Ввести DTO/Value Objects для ключевых сущностей (ProductData, OrderData, DocTemplateConfig).
2. Использовать касты Eloquent (`$casts`) и кастомные accessor/mutator вместо ручной работы с массивами.
3. Постепенно переписывать сервисы на работу с типизированными объектами.

## Следующие шаги
- 🟧 Ответственный: Backend
- ⏱ Срок: 1-2 месяца (итерациями по доменам)
- 📌 Контроль: новые фичи должны использовать DTO, рефакторинг legacy — по мере выхода задач.
